pipeline {
    agent {
        label params.AGENT_LABEL
    }
    stages {
        stage('Trigger Builds') {
            parallel {
                stage('Linux x86 64') {
                    steps {
                        build job: LINUX_X86_64_JOB, propagate: true, wait: true, parameters:
                        [
                            string(name: 'SAPMACHINE_GIT_REPOSITORY', value: params.SAPMACHINE_GIT_REPOSITORY),
                            string(name: 'SAPMACHINE_GIT_BRANCH', value: params.SAPMACHINE_GIT_BRANCH),
                            string(name: 'GIT_TAG_NAME', value: params.GIT_TAG_NAME),
                            [$class: 'BooleanParameterValue', name: 'RUN_TESTS', value: false],
                            [$class: 'BooleanParameterValue', name: 'PUBLISH', value: false],
                            [$class: 'BooleanParameterValue', name: 'PROPAGATE_RESULT', value: true],
                            [$class: 'BooleanParameterValue', name: 'RELEASE', value: false]
                        ]
                    }
                }
                stage('Linux ppc64le') {
                    steps {
                        build job: LINUX_PPC64LE_JOB, propagate: true, wait: true, parameters:
                        [
                            string(name: 'SAPMACHINE_GIT_REPOSITORY', value: params.SAPMACHINE_GIT_REPOSITORY),
                            string(name: 'SAPMACHINE_GIT_BRANCH', value: params.SAPMACHINE_GIT_BRANCH),
                            string(name: 'GIT_TAG_NAME', value: params.GIT_TAG_NAME),
                            [$class: 'BooleanParameterValue', name: 'RUN_TESTS', value: false],
                            [$class: 'BooleanParameterValue', name: 'PUBLISH', value: false],
                            [$class: 'BooleanParameterValue', name: 'PROPAGATE_RESULT', value: true],
                            [$class: 'BooleanParameterValue', name: 'RELEASE', value: false]
                        ]
                    }
                }
                stage('Linux ppc64') {
                    steps {
                        build job: LINUX_PPC64_JOB, propagate: true, wait: true, parameters:
                        [
                            string(name: 'SAPMACHINE_GIT_REPOSITORY', value: params.SAPMACHINE_GIT_REPOSITORY),
                            string(name: 'SAPMACHINE_GIT_BRANCH', value: params.SAPMACHINE_GIT_BRANCH),
                            string(name: 'GIT_TAG_NAME', value: params.GIT_TAG_NAME),
                            [$class: 'BooleanParameterValue', name: 'RUN_TESTS', value: false],
                            [$class: 'BooleanParameterValue', name: 'PUBLISH', value: false],
                            [$class: 'BooleanParameterValue', name: 'PROPAGATE_RESULT', value: true],
                            [$class: 'BooleanParameterValue', name: 'RELEASE', value: false]
                        ]
                    }
                }
            }
            post {
                success {
                    copyArtifacts filter: '	sapmachine-*.tar.gz	', projectName: LINUX_X86_64_JOB, selector: downstream(upstreamBuildNumber: env.BUILD_NUMBER, upstreamProjectName: env.JOB_NAME)
                    copyArtifacts filter: '	sapmachine-*.tar.gz	', projectName: LINUX_PPC64LE_JOB, selector: downstream(upstreamBuildNumber: env.BUILD_NUMBER, upstreamProjectName: env.JOB_NAME)
                    copyArtifacts filter: '	sapmachine-*.tar.gz	', projectName: LINUX_PPC64_JOB, selector: downstream(upstreamBuildNumber: env.BUILD_NUMBER, upstreamProjectName: env.JOB_NAME)
                }
            }
        }
    }
}
